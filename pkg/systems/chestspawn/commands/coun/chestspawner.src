use uo;
use os;
use util;

var layout := array(
	"page 0                            ",
	"resizepic 0 50 2620 400 600",
//	"gumppic   0   0  206              ",
/*	"gumppic  44   0  201              ",
	"gumppic 444   0  207              ",
	"gumppic   0  40  202              ",
	"gumppic  44  40 2604              ",
	"gumppic 444  40  203              ",
	"gumppic   0 350  204              ",
	"gumppic  44 350  233              ",
	"gumppic 444 350  205              ",*/
	"gumppic 251 160 2444              ",
    "text    155  40  900    0         ",
    "text     55  70  900    1         ",
    "text     55 100  900    2         ",
    "text     55 130  900    3         ",
    "text     55 160  900    4         ",
    "text     55 260  900    6         ",
    "text     55 290  900    7         ",
    "button  300 260  208  209  1  0 89",
    "button  300 290  208  209  1  0 79",
    "textentry 260 160   50 30 0  5  5   ",
    "button  300 580 2450 2451  1  0 99",
    "group 2",
    "radio   200  70 208  2225  1 11   ",
    "radio   225  70 208  2226  0 12   ",
    "radio   250  70 208  2227  0 13   ",
    "radio   275  70 208  2228  0 14   ",
    "radio   300  70 208  2229  0 15   ",
    "group 3",
    "radio   200 100 208  2226  1 22   ",
    "radio   225 100 208  2227  0 23   ",
    "radio   250 100 208  2228  0 24   ",
    "radio   275 100 208  2229  0 25   ",
    "radio   300 100 208  2230  0 26   ",
    "radio   325 100 208  2231  0 27   ",
    "radio   350 100 208  2232  0 28   ",
    "group 4",
    "radio   200 130 208  2226  1 32   ",
    "radio   225 130 208  2227  0 33   ",
    "radio   250 130 208  2228  0 34   ",
    "radio   275 130 208  2229  0 35   ",
    "radio   300 130 208  2230  0 36   ",
    "radio   325 130 208  2231  0 37   ",
    "radio   350 130 208  2232  0 38   ",

    "group 5",
    //"text     55 320  900    8        ",
    //"text     55 340  900    9        ",
    //"text     55 360  900    10        ",
    //"text     55 380  900    11        ",
    //"text     55 400  900    12        ",
    //"text     55 420  900    13        ",
    //"text     55 440  900    14        ",
    //"radio   200 340 208  2226  1 41   ", //humano
    //"radio   200 360 208  2227  0 42   ", //elfo
    //"radio   200 380 208  2228  0 43   ", //anao
    //"radio   200 400 208  2229  0 44   ", //hobbit
    //"radio   200 420 208  2230  0 45   ", //drow
    //"radio   200 440 208  2231  0 46   ",  //orc

    "group 6",
    "text     55 460  900    15        ",
    "text     55 480  900    16        ",
    "text     55 500  900    17        ",
    "text     55 520  900    18        ",
    "text     55 540  900    19        ",
    "radio   200 480 208  2226  1 51   ", //warrior
    "radio   200 500 208  2227  0 52   ", //thief
    "radio   200 520 208  2228  0 53   ", //mage
    "radio   200 540 208  2229  0 54   " //crafter

);

var data := array(
    "Chest Spawn Interface",
    "Chest Level",
    "Chest Amount",
    "Spawn Radius",
    "Rest Period [in minutes]",
    "1",
    "Show Chest Spawners [radius 5]",
    "Hide Chest Spawners [radius 5]",
    "Race Loot:", //8
    "Human",
    "Elf",
    "Dwarf",
    "Drow",
    "Orc",
    "Hobbit",
    "Class Loot",
    "Warrior",
    "Thief",
    "Mage",
    "Crafter"
);

program chestspawner(who)
  var res := SendDialogGump(who, layout, data);
  if(res[0] == 99)
    var duration := res[5];
    var amount;
    var level;
    var range;
    var race;
    var classe;
    foreach thing in (res.keys)
      if((thing >= 10) && (thing < 20))
        level := thing - 10;
      elseif((thing >= 20) && (thing < 30))
        amount := thing - 20;
      elseif((thing >= 30) && (thing < 40))
        range := thing - 30;
      elseif((thing >= 40) && (thing < 50))
        race := thing - 40;
      elseif((thing >= 50) && (thing < 60))
        classe := thing - 50;
      endif
    endforeach
   // var targ := TargetCoordinates(who);
   // if(!targ)
   //   return;
  //  endif
    duration[1, find(duration, ": ", 1)+1]:="";
    var newduration := (CInt(duration) * 60);
    if(newduration < 60)
      SendSysMessage(who,"Duration Error: Aborting");
      return;
    endif
    var item := CreateItemAtLocation(who.x, who.y, who.z, "chestspawner", 1, who.realm);
    SendSysMessage(who, "item " + item);
    SetObjProperty(item,"level", level);
    SetObjProperty(item,"range", range);
    SetObjProperty(item,"amount", amount);
    SetObjProperty(item,"duration", CInt(newduration));
    var racestring := "Humano";
  /*  case (cint(race))
       1: racestring := "Humano";
       2: racestring := "Elfo";
       3: racestring := "Anao";
       4: racestring := "Hobbit";
       5: racestring := "Drow";
       6: racestring := "Orc";
    endcase*/
    SetObjProperty(item, "race", racestring);
    var classstring;
    case (cint(classe))
       1: classstring := "Guerreiro";
       2: classstring := "Ladino";
       3: classstring := "Sabio";
       4: classstring := "Artifice";
    endcase
    SetObjProperty(item, "classe", classstring);
    EraseObjProperty(item,"waiting");
    item.locked :=  1;
    item.movable := 0;
    item.invisible := 1;
  elseif(res[0] == 89)
    foreach item in ListItemsNearLocationOfType( who.x, who.y, who.z, 5, 0x888b, who.realm);
      item.graphic := 4483;
    endforeach
  else
    foreach item in ListItemsNearLocationOfType( who.x, who.y, who.z, 5, 0x888b, who.realm);
      item.graphic := 1;
    endforeach
  endif
endprogram
