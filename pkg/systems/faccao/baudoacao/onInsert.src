use uo;
use os;
use cfgfile;
use datafile;
use guilds;

include "include/say";
include ":datafile:datafile";
include ":faccao:include/shared_functions";

program onInsert(character, container, movetype, inserttype, adding_item, existing_stack, amount_to_add)
   var donation_types := array{
    "IsKingdomDonationComida",
    "IsKingdomDonationMoedas",
    "IsKingdomDonationCouro",
    "IsKingdomDonationMetal",
    "IsKingdomDonationMadeira",
    "IsKingdomDonationPano",
    "IsKingdomDonationPedra",
    "IsKingdomDonationJoias"
};

foreach donation_type in donation_types
var prop_value := GetObjProperty(adding_item, donation_type);
if (prop_value)
    var resource_type := Lower(donation_type[18, len(donation_type)]);
    var amount;
if (adding_item)
    amount := adding_item.amount;
else
    amount := 0;
endif
        
        // Marcar recursos como modificados para atualização posterior
var result := MarcarRecursosModificados(container);
if (result == error)
    SendSysMessageEx(character, "Erro ao processar a doação.", SSM_FAIL);
endif
        
        SendSysMessageEx(character, "Doação de " + amount + " " + resource_type + " registrada com sucesso.", SSM_INFO);
        break;
    endif
endforeach


    if (Cint(inserttype) == 2)
        if (!(character.concealed || character.hidden))
            var stack_desc := "";
var container_desc := "";
if (existing_stack)
    stack_desc := existing_stack.desc;
endif
if (container)
    container_desc := container.desc;
endif
PrintText(character, "*Acrescentou " + amount_to_add + ", totalizando " + stack_desc + " na " + container_desc + "*", 6);
        endif
    else
        if (!(character.concealed || character.hidden))
            var item_desc := "";
var container_desc := "";
if (adding_item)
    item_desc := adding_item.desc;
endif
if (container)
    container_desc := container.desc;
endif
PrintText(character, "*Colocou "+ item_desc +" no "+ container_desc +"*", 6);
        endif
    endif

    return 1;
endprogram